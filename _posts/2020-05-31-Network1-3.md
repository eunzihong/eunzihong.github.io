---
layout: post
title: Network Core
---

Computer Networking: A top-down approach  
[Chapter 1] Computer Networks and the Internet  
1.3 Network Core  

----  

### 1.3.1 패킷 교환 Packet Switching  
각 엔드 시스템간의 데이터는 규격화된 작은 데이터 패키지로 나뉘어 전달이 되고, 이 패키지를 **패킷(Packet)** 이라 한다. 패킷은 **링크**와 **패킷 스위치 노드**를 통해 전달된다. 링크 상에서는 링크의 최대 전송 속도로 전송된다. L bits의 패킷을 R bps의 링크에서 전송한다면 L/R초의 시간이 소요된다.  

#### 저장 후 전달 Store-and-Forward Transmission  
각 패킷이 작은 데이터 패키지라고는 하지만 한 패킷 안에서 먼저 도착하는 앞부분 비트가 있고 아직 전송 중인 남은 비트들이 있다. 라우터는 이 비트가 들어옴과 동시에 바로 다음 라우터로 보내는 것이 아니고 한 패킷의 비트들이 모두 들어올 때까지 기다렸다가 패킷이 완전이 다 들어오면 그 때 포워딩(전송, forwarding)을 한다.  

![store-and-forward](../images/store-and-forward.jpg)  

1. 첫 패킷이 도착할 때까지는 L/R초의 시간을 온전히 기다린다.
2. 먼저 도착한 첫 패킷은 다음 목적지(호스트 또는 다른 라우터)에 보낸다.
3. 첫 패킷이 전송되는 동안 계속해서 나머지 패킷이 해당 라우터로 들어온다.
4. 마지막 패킷까지 모두 전송을 하고 전송을 마무리한다.  

따라서 P개의 패킷이 한 개의 노드 라우터를 거쳐서 포워딩이 될 때는 (P+1)L/R초의 시간이 소요된다.  

만약 최종 목적지까지 N개의 링크, 즉 N-1개의 라우터를 거친다면 얼마의 시간이 걸릴까?  

![multirouter_packet](../images/NlinkPpacket.jpg)  

1. 첫 패킷이 N개의 링크를 이동하는 시간은 NL/R초가 소요된다. (빨간 패킷)
2. 첫 패킷 이후 P-1개의 패킷이 남아있고 이 패킷들이 각각 L/R초당 하나씩 마지막 링크를 통과한다. (P-1)L/R초  
3. 총 소요시간은 NL/R + (P-1)L/R = (N + P-1)L/R초  

따라서 N개의 링크를 통해 P개의 패킷이 포워딩 될 때는 (N+P-1)L/R초의 시간이 소요된다.  
첫 번째 그림의 경우는 N = 2, P = 3인 경우로 볼 수 있으므로 (2+3-1)L/R = 4L/R이고 식이 맞다는 것을 확인할 수 있다.  

(하 뿌듯)  

#### 큐잉 지연과 패킷 손실 Queuing Delays & Packet Loss  
각 패킷 스위치들은 여러 갈래의 링크들과 연결되어 있다. 패킷 스위치는 각 링크에 대한 **출력 버퍼(output buffer)** 혹은 **출력 큐(ouput queue)** 를 가지고 있다. 어떤 패킷들을 특정 링크로 보내야 하는데, 이미 그 링크에서 다른 패킷을 전송하고 있다면 그 전송이 끝날 때까지 기다려야 하고, 이때 출력 버퍼에 머무르게 된다. 이 때 발생하는 지연을 **큐잉 지연(queuing delay)** 이라 한다. 대기하는 패킷이 너무 많아서 출력 버퍼가 가득 찬 상태에서 새로운 패킷이 또 들어오게 된다면 새 패킷 혹은 기존의 패킷 중 일부가 폐기되고 이러한 손실을 **패킷 손실(packet loss)** 이라 한다.  

- 출력 버퍼 output buffer : 라우터 출력 링크의 패킷 임시 저장 버퍼 
- 큐잉 지연 queuing delay : 해당 링크에서 앞서 전송되는 패킷들에 의해 발생하는 대기 시간 
- 패킷 손실 pakcet loss : 출력 버퍼 크기를 초과하는 양의 패킷이 들어올 때 일부 패킷이 손실되는 현상 

#### 전달 테이블과 라우팅 프로토콜 Forwarding Tables & Routing Protocols  
라우터는 패킷을 수신하고 패킷의 목적지를 향한 다음 라우터로 패킷을 포워딩한다. 이 '다음 라우터'와 '발신 링크'는 어떻게 결정 될까?  
인터넷 네트워크의 엔드 시스템들은 각자 IP주소를 갖고 있다. 패킷을 보내는 쪽의 엔드 시스템에서 패킷을 보낼 때에 패킷 헤더에 도착지 엔드 시스템의 IP주소를 기록해둔다. 이 주소를 라우터가 활용하게 된다. 라우터는 **전달 테이블(forwarding table)** 을 가지고 있고 이 테이블에는 IP주소에 따른 출력 링크가 매핑되어있다. 패킷이 도착할 때 패킷 헤더의 주소를 읽고 테이블을 조회하여 해당하는 출력 링크를 찾는다.   
각 라우터에 전달 테이블을 구성하는 데에는 여러 방법이 있는데, 이를 **라우팅 프로토콜(routing protocol)** 이라 한다.  

- 전달 테이블 forwarding table : 라우터 내의 IP주소 - 출력 링크 매핑 테이블  
- 라우팅 프로토콜 routing protocol : 전달 테이블을 구성하는 프로토콜  

### 1.3.2 회선 교환 Circuit Switching  
엔드 시스템들간의 데이터 교환은 패킷 스위칭 말고도 **회선 교환(circuit switching)** 이 있다. 패킷 스위칭은 송신 엔드 시스템에서 수신 엔드 시스템으로 일단 패킷을 보내보는 것으로 시작되는 반면 회선 교환은 미리 예약을 해야한다. 통신에 필요한 자원(링크, 버퍼, 전송속도 등)이 미리 예약되어 확보되어 통신이 시작되므로 일정 전송 속도를 보장한다.   
회선 스위치에 각 엔드 시스템이 바로 연결되어 있고 스위체 링크가 연결되어 있고 이 링크는 여러 회선(circuit)으로 이루어져 있다. 엔드시스템 간의 통신이 시작될 때 각 링크의 회선 하나씩을 예약한다. 링크의 전송 속도가 R bps일 때 해당 링크가 n개의 회선으로 나뉘어 있으면 그 회선은 R/n bps의 전송 속도를 갖는다. 회선 수만큼 동시 연결할 수 있다.   
전화나 팩시밀리가 대표적인 회선 교환 방식의 네트워크이다. 무작정 수신자에게 패킷을 보내는 것이 아니라 먼저 전화 신호음을 보내고 연결이 수립되면 정해진(예약된) 회선으로 일정 전송속도로 패킷을 전송한다.  

#### 회선 교환 네트워크 다중 연결 Multiplexing in Circuit-Switched Networks  
한 링크가 여러 회선으로 분할될 때에는 주파수 혹은 시간에 따라 다중화 될 수 있다.  

- 주파수 분할 다중화(Frequency-division multiplexing, FDM) : 해당 링크의 주파수 스펙트럼을 정해진 폭(bandwith)만큼 분할하여 고정 주파수에서 연결. 각 회선이 지속적으로 대역폭의 일부를 얻음.  
- 시간 분할 다중화(Time-division multiplexing, TDM) : 시간을 일정 주기 프레임으로 구분하고 프레임 안에 일정 시간의 슬롯이 나뉘어 각 회선에 하나씩 배정. 한 프레임동안 한 슬롯이 한 회선에 쓰이고 프레임이 반복되면서 회선 연결이 이어짐. 각 회선이 슬롯동안 주기적으로 전체 대역폭(bandwith)를 얻음. 링크 속도 8,000프레임/초 * 8비트/슬롯 = 회선 전송률 64kbps    

TDM 시간 계산 예시  
- 640,000비트의 파일 전송
- 링크 프레임당 시간 슬롯 24개
- 링크 전송속도 1.536Mbps
- 회선 설정 지연 0.5초  
회선 전송 속도 = 1.536Mbps/24 = 64kbps  
파일 전송 시간 = 640,000/64,000 = 10s  
최종 시간 = 10s + 0.5s = 10.5s  

#### Packet Switching vs Circuit Switching  
Packet Switching weakpoints  

- 가변적이고 예측할 수 없는 지연(큐잉 지연)  
- 실시간 서비스; 전화, 화상회의 등에는 적합하지 않음

Packet Switching strength  

- 링크에 대한 연결들의 전송 용량의 공유가 더 효율적  
- 패킷 교환이 더 간단하고 효율적이고 구현 비용이 적음  

예시  
1. 비활성시간이 더 긴 연결인 경우 연결 시간내내 해당 회선을 예약해두면 회선 갯수만큼의 연결밖에 성립 불가 패킷 교환의 경우 일시 다발적으로 연결 혹은 전송이 몰려도 35명 중 11명이 전부 접속중일 확률이 0.0004%뿐일만큼 연결이 겹치지 않을 가능성 높고 링크 전송 속도를 온전히 이용할 가능성 높음  
2. 1명이 1000개의 패킷을 전송하고 나머지는 비활성 상태일때 회선 교환의 경우 1명이 1/n의 링크만 사용할 수 있고 나머지는 사용여부에 관계없이 놀게됨 패킷 교환의 경우 한 명만 할 일이 많으면 후다닥 전체 링크로 처리가능  


### 1.3.3 네트워크의 네트워크 Network of Networks  
ISP에 의해 각 가정, 기업, 학교 등이 인터넷을 공급받고 사용자가 이용한다. 이러한 인터넷의 진정한 연결을 위해서는 각 ISP끼리도 연결이 되어있어야 한다. 지역 내 ISP는 글로벌 통과 ISP(global transit ISP)와 연결되어 다른 지역의 ISP와 통신한다.  
이러한 네트워크 구조는 1형에서 시작하여 2012년 5형까지 발달하였다. 5형은 구글에서 시행중인 콘텐트-제공자 네트워크(content-provider network)이다. 구글은 전 세계에 수십 수백개의 데이터센터를 가져 사설 TCP/IP네트워크로 유저에게 컨텐츠를 제공한다. 하위 계층 지역 ISP와 직접 연결되어 상위 계층 ISP 연결 비용을 줄이고 네트워크 연결 데이터를 점유한다.   

<br>
<br>