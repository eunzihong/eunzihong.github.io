---
layout: post
title: Network Core
---

Computer Networking: A top-down approach  
[Chapter 1] Computer Networks and the Internet  
1.3 Network Core  

----  

### 1.3.1 패킷 교환 Packet Switching  
각 엔드 시스템간의 데이터는 규격화된 작은 데이터 패키지로 나뉘어 전달이 되고, 이 패키지를 **패킷(Packet)** 이라 한다. 패킷은 **링크**와 **패킷 스위치 노드**를 통해 전달된다. 링크 상에서는 링크의 최대 전송 속도로 전송된다. L bits의 패킷을 R bps의 링크에서 전송한다면 L/R초의 시간이 소요된다.  

#### 저장 후 전달 Store-and-Forward Transmission  
각 패킷이 작은 데이터 패키지라고는 하지만 한 패킷 안에서 먼저 도착하는 앞부분 비트가 있고 아직 전송 중인 남은 비트들이 있다. 라우터는 이 비트가 들어옴과 동시에 바로 다음 라우터로 보내는 것이 아니고 한 패킷의 비트들이 모두 들어올 때까지 기다렸다가 패킷이 완전이 다 들어오면 그 때 포워딩(전송, forwarding)을 한다.  

![store-and-forward](../images/store-and-forward.jpg)  

1. 첫 패킷이 도착할 때까지는 L/R초의 시간을 온전히 기다린다.
2. 먼저 도착한 첫 패킷은 다음 목적지(호스트 또는 다른 라우터)에 보낸다.
3. 첫 패킷이 전송되는 동안 계속해서 나머지 패킷이 해당 라우터로 들어온다.
4. 마지막 패킷까지 모두 전송을 하고 전송을 마무리한다.  

따라서 P개의 패킷이 한 개의 노드 라우터를 거쳐서 포워딩이 될 때는 (P+1)L/R초의 시간이 소요된다.  

만약 최종 목적지까지 N개의 링크, 즉 N-1개의 라우터를 거친다면 얼마의 시간이 걸릴까?  

![multirouter_packet](../images/NlinkPpacket.jpg)  

1. 첫 패킷이 N개의 링크를 이동하는 시간은 NL/R초가 소요된다. (빨간 패킷)
2. 첫 패킷 이후 P-1개의 패킷이 남아있고 이 패킷들이 각각 L/R초당 하나씩 마지막 링크를 통과한다. (P-1)L/R초  
3. 총 소요시간은 NL/R + (P-1)L/R = (N + P-1)L/R초  

따라서 N개의 링크를 통해 P개의 패킷이 포워딩 될 때는 (N+P-1)L/R초의 시간이 소요된다.  
첫 번째 그림의 경우는 N = 2, P = 3인 경우로 볼 수 있으므로 (2+3-1)L/R = 4L/R이고 식이 맞다는 것을 확인할 수 있다.  

(하 뿌듯)  

#### 큐잉 지연과 패킷 손실 Queuing Delays & Packet Loss  
각 패킷 스위치들은 여러 갈래의 링크들과 연결되어 있다. 패킷 스위치는 각 링크에 대한 **출력 버퍼(output buffer)** 혹은 **출력 큐(ouput queue)** 를 가지고 있다. 어떤 패킷들을 특정 링크로 보내야 하는데, 이미 그 링크에서 다른 패킷을 전송하고 있다면 그 전송이 끝날 때까지 기다려야 하고, 이때 출력 버퍼에 머무르게 된다. 이 때 발생하는 지연을 **큐잉 지연(queuing delay)** 이라 한다. 대기하는 패킷이 너무 많아서 출력 버퍼가 가득 찬 상태에서 새로운 패킷이 또 들어오게 된다면 새 패킷 혹은 기존의 패킷 중 일부가 폐기되고 이러한 손실을 **패킷 손실(packet loss)** 이라 한다.  

- 출력 버퍼 output buffer : 라우터 출력 링크의 패킷 임시 저장 버퍼 
- 큐잉 지연 queuing delay : 해당 링크에서 앞서 전송되는 패킷들에 의해 발생하는 대기 시간 
- 패킷 손실 pakcet loss : 출력 버퍼 크기를 초과하는 양의 패킷이 들어올 때 일부 패킷이 손실되는 현상 

#### 전달 테이블과 라우팅 프로토콜 Forwarding Tables & Routing Protocols  
라우터는 패킷을 수신하고 패킷의 목적지를 향한 다음 라우터로 패킷을 포워딩한다. 이 '다음 라우터'와 '발신 링크'는 어떻게 결정 될까?  
인터넷 네트워크의 엔드 시스템들은 각자 IP주소를 갖고 있다. 패킷을 보내는 쪽의 엔드 시스템에서 패킷을 보낼 때에 패킷 헤더에 도착지 엔드 시스템의 IP주소를 기록해둔다. 이 주소를 라우터가 활용하게 된다. 라우터는 **전달 테이블(forwarding table)** 을 가지고 있고 이 테이블에는 IP주소에 따른 출력 링크가 매핑되어있다. 패킷이 도착할 때 패킷 헤더의 주소를 읽고 테이블을 조회하여 해당하는 출력 링크를 찾는다.   
각 라우터에 전달 테이블을 구성하는 데에는 여러 방법이 있는데, 이를 **라우팅 프로토콜(routing protocol)** 이라 한다.  

- 전달 테이블 forwarding table : 라우터 내의 IP주소 - 출력 링크 매핑 테이블  
- 라우팅 프로토콜 routing protocol : 전달 테이블을 구성하는 프로토콜  

### 1.3.2 회선 교환 Circuit Switching  
엔드 시스템들간의 데이터 교환은 패킷 스위칭 말고도 **회선 교환(circuit switching)** 이 있다. 패킷 스위칭은 송신 엔드 시스템에서 수신 엔드 시스템으로 일단 패킷을 보내보는 것으로 시작되는 반면 회선 교환은 미리 예약을 해야한다. 통신에 필요한 자원(링크, 버퍼, 전송속도 등)이 미리 예약되어 확보되어 통신이 시작되므로 일정 전송 속도를 보장한다.   
